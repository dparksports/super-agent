<ContentDialog
    x:Class="OpenClaw.Windows.Views.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:OpenClaw.Windows.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Settings"
    CloseButtonText="Close">

    <StackPanel Spacing="20" Width="300">
        <!-- Safety Section -->
        <StackPanel Spacing="10">
            <TextBlock Text="ðŸ›¡ï¸ Safety" Style="{ThemeResource SubtitleTextBlockStyle}" />
            <ToggleSwitch x:Name="HitlToggle" 
                          Header="Require Approval for Unsafe Tools" 
                          OnContent="On" 
                          OffContent="Off" 
                          ToolTipService.ToolTip="When ON, the agent will ask for your approval before running scripts, installing packages, browsing, sending messages, etc."/>
            <TextBlock Text="When off, the agent will still notify you of what it's doing, but won't wait for approval." 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
        </StackPanel>

        <MenuFlyoutSeparator />

        <!-- Agent Guide Section -->
        <StackPanel Spacing="10">
            <TextBlock Text="ðŸ“‹ Agent Guide" Style="{ThemeResource SubtitleTextBlockStyle}" />
            <TextBlock Text="A guide.md file gives the agent rules about what it should and shouldn't do â€” like a parent setting boundaries." 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
            <Button x:Name="EditGuideButton" 
                    Content="ðŸ“ Edit Agent Guide" 
                    Click="EditGuideButton_Click"
                    HorizontalAlignment="Stretch" />
            <TextBlock x:Name="GuideStatusText" 
                       Text="" 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
        </StackPanel>

        <MenuFlyoutSeparator />

        <!-- Privacy Section -->
        <StackPanel Spacing="10">
            <TextBlock Text="ðŸ”’ Privacy" Style="{ThemeResource SubtitleTextBlockStyle}" />
            <ToggleSwitch x:Name="AnalyticsToggle" 
                          Header="Share Usage Data" 
                          OnContent="On" 
                          OffContent="Off" 
                          ToolTipService.ToolTip="Help us improve by sending anonymous usage data."/>
            <TextBlock Text="We collect anonymous data to fix bugs and improve performance. No personal content is shared." 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
        </StackPanel>

        <MenuFlyoutSeparator />

        <!-- AI Model Section -->
        <StackPanel Spacing="10">
            <TextBlock Text="ðŸ§  AI Model" Style="{ThemeResource SubtitleTextBlockStyle}" />
            
            <ComboBox x:Name="ModelComboBox" 
                      Header="Select Model" 
                      HorizontalAlignment="Stretch"
                      SelectionChanged="ModelComboBox_SelectionChanged">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel>
                            <TextBlock Text="{Binding Name}" FontWeight="Bold" />
                            <TextBlock Text="{Binding Description}" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- VRAM Use Bar -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="VRAM Usage" Style="{ThemeResource CaptionTextBlockStyle}" />
                <TextBlock x:Name="VramStatsText" Text="0 / 0 GB" Style="{ThemeResource CaptionTextBlockStyle}" HorizontalAlignment="Right" />
                
                <ProgressBar x:Name="VramProgressBar" Grid.Row="1" Maximum="100" Value="0" Height="10" Margin="0,5,0,0" />
            </Grid>
            <TextBlock x:Name="VramWarningText" Text="" Foreground="Red" Style="{ThemeResource CaptionTextBlockStyle}" Visibility="Collapsed" TextWrapping="Wrap" />

            <!-- Action Buttons -->
             <Button x:Name="DownloadModelButton" 
                    Content="Download Model" 
                    Click="DownloadModelButton_Click"
                    HorizontalAlignment="Stretch" 
                    Style="{ThemeResource AccentButtonStyle}"/>
            
            <ProgressBar x:Name="DownloadProgressBar" Maximum="100" Value="0" Visibility="Collapsed" />
            <TextBlock x:Name="DownloadStatusText" Text="" Style="{ThemeResource CaptionTextBlockStyle}" HorizontalAlignment="Center" Visibility="Collapsed" />
            
             <TextBlock Text="Models are optimized for DirectML (ONNX) and run locally." 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
        </StackPanel>

        <MenuFlyoutSeparator />

        <!-- Testing / Debugging Section -->
        <StackPanel Spacing="10">
            <TextBlock Text="ðŸ› Debugging" Style="{ThemeResource SubtitleTextBlockStyle}" />
            <Button x:Name="ResetEulaButton" 
                    Content="Reset EULA acceptance" 
                    Click="ResetEulaButton_Click"
                    HorizontalAlignment="Stretch" />
             <TextBlock Text="This will force the EULA dialog to appear on next restart." 
                       Style="{ThemeResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                       TextWrapping="Wrap" />
        </StackPanel>
    </StackPanel>
</ContentDialog>
